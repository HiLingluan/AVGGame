-- des:{状态基类}
-- author:{zpf}
-- date: 2021-12-16 09:33:00
--
local BaseState = class("BaseState")

local traceback = function(err)
    CS.UnityEngine.Debug.LogError("Lua Change State Error: " .. tostring(err).."\n"..debug.traceback())
end

function BaseState:ctor(type)
    self:initProperty()
    self.type = type
end

function BaseState:initProperty()
    self.type = nil                 --状态类型
    self.isInit = false             --是否初始化
    self.owner = nil                --状态持有者
    self.fsm = nil                  --状态机
    self.isStop = false             --是否暂停
end

local safeEnter = function(self)
    if not self.isInit then
        self:init()
        self.isInit = true
    end
    self:onEnter()
end

function BaseState:init()
    self:onInit()
end

function BaseState:enter()
    xpcall(safeEnter,traceback,self)
end

local safeLeave = function(self)
    self:onLeave()
end

function BaseState:leave()
    xpcall(safeLeave,traceback,self)
end

local safeUpdate = function(self,deltaTime,unScaleDeltaTime)
    self:onUpdate(deltaTime,unScaleDeltaTime)
end

function BaseState:update(deltaTime,unScaleDeltaTime)
    xpcall(safeUpdate,traceback,self,deltaTime,unScaleDeltaTime)
end

local safeDestroy = function(self)
    self.isInit = false
    self:onDestroy()
end

function BaseState:destroy()
    xpcall(safeDestroy,traceback,self)
end

function BaseState:changeState(type)
    self.fsm:changeState(type)
end

function BaseState:getOwner()
    return self.owner
end

function BaseState:setData(key,data)
    self.fsm:setData(key,data)
end

function BaseState:getData(key)
    return self.fsm:getData(key)
end

--//-----------------------------------------------------

function BaseState:onInit()
    
end

function BaseState:onEnter()
    
end

function BaseState:onUpdate(deltaTime,unScaleDeltaTime)
    
end


function BaseState:onLeave()
    
end

function BaseState:onDestroy()
    
end



return BaseState